name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # 或者您的默认分支

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Generate config
        env:
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          FIREBASE_DATABASE_URL: ${{ secrets.FIREBASE_DATABASE_URL }}
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          FIREBASE_MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}
          CLOUDINARY_CLOUD_NAME: ${{ secrets.CLOUDINARY_CLOUD_NAME }}
          CLOUDINARY_API_KEY: ${{ secrets.CLOUDINARY_API_KEY }}
          CLOUDINARY_API_SECRET: ${{ secrets.CLOUDINARY_API_SECRET }}
        run: |
          cat > config.js << 'EOL'
          const config = {
              firebase: {
                  apiKey: "${{ secrets.FIREBASE_API_KEY }}",
                  authDomain: "${{ secrets.FIREBASE_AUTH_DOMAIN }}",
                  databaseURL: "${{ secrets.FIREBASE_DATABASE_URL }}",
                  projectId: "${{ secrets.FIREBASE_PROJECT_ID }}",
                  storageBucket: "${{ secrets.FIREBASE_STORAGE_BUCKET }}",
                  messagingSenderId: "${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}",
                  appId: "${{ secrets.FIREBASE_APP_ID }}",
                  measurementId: "${{ secrets.FIREBASE_MEASUREMENT_ID }}"
              },
              cloudinary: {
                  cloudName: "${{ secrets.CLOUDINARY_CLOUD_NAME }}",
                  apiKey: "${{ secrets.CLOUDINARY_API_KEY }}",
                  apiSecret: "${{ secrets.CLOUDINARY_API_SECRET }}"
              }
          };
          EOL

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: . 